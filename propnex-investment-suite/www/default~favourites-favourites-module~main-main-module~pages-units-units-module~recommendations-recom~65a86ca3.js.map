{"version":3,"sources":["./src/app/services/place.service.ts"],"names":[],"mappings":"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","file":"default~favourites-favourites-module~main-main-module~pages-units-units-module~recommendations-recom~65a86ca3.js","sourcesContent":["import { HttpClient } from '@angular/common/http';\r\nimport { Injectable } from '@angular/core';\r\nimport { BehaviorSubject, of } from 'rxjs';\r\nimport { map, switchMap, take, tap } from 'rxjs/operators';\r\nimport { fbPostal, fbRec, fbUnit } from '../pages/auth/firebase.model';\r\n\r\n@Injectable({\r\n  providedIn: 'root'\r\n})\r\n\r\nexport class PlaceService {\r\n\r\n  private _fbPostals = new BehaviorSubject<fbPostal[]>([]);\r\n  private _fbRecs = new BehaviorSubject<fbRec[]>([]);\r\n  private _currPlace: fbPostal;\r\n  private _currUnit: fbUnit;\r\n\r\n\r\n  get fbPostals() {\r\n    return this._fbPostals.asObservable();\r\n  }\r\n\r\n  get fbRecs() {\r\n    return this._fbRecs.asObservable();\r\n  }\r\n\r\n  get currPlace() {\r\n    return this._currPlace;\r\n  }\r\n\r\n  get currUnit() {\r\n    return this._currUnit;\r\n  }\r\n\r\n  set currPlace(currPlace: fbPostal) {\r\n    this._currPlace = currPlace;\r\n  }\r\n\r\n  set currUnit(currUnit: fbUnit) {\r\n    this._currUnit = currUnit;\r\n  }\r\n\r\n\r\n  constructor(\r\n    private http: HttpClient\r\n  ) { }\r\n\r\n\r\n  // fetch place data\r\n  fetchFBPostals() {\r\n    return this.http\r\n      .get(\r\n        `https://propnexpostals-default-rtdb.asia-southeast1.firebasedatabase.app/.json`\r\n      )\r\n      .pipe(\r\n        map(resData => {\r\n          const postals: fbPostal[] = [];\r\n          for (const key in resData) {\r\n            if (resData.hasOwnProperty(key)) {\r\n              postals.push(\r\n                new fbPostal(\r\n                  resData[key].name, \r\n                  resData[key].postal,\r\n                  resData[key].landArea,\r\n                  resData[key].grossFloorArea,\r\n                  resData[key].tenure,\r\n                  resData[key].numRooms,\r\n                  resData[key].numStorey,\r\n                  resData[key].askingPrice,\r\n                  resData[key].priceRoom,\r\n                  resData[key].GFA,\r\n                  resData[key].roomRate,\r\n                  resData[key].netOperatingProfit,\r\n                  resData[key].approvedUsage,\r\n                  resData[key].locationMRT,\r\n                  resData[key].locationSch,\r\n                  resData[key].imageUrl,\r\n                  resData[key].units\r\n                )\r\n              );\r\n            }\r\n          }\r\n          return postals;\r\n        }),\r\n        tap(postals => {\r\n          this._fbPostals.next(postals);\r\n        })\r\n      );\r\n  }\r\n\r\n  // fetch recommendation data\r\n  fetchFBRecs() {\r\n    return this.http\r\n      .get(\r\n        `https://propnexpostals-default-rtdb.asia-southeast1.firebasedatabase.app/.json`\r\n      )\r\n      .pipe(\r\n        map(resData => {\r\n          const places: fbRec[] = [];\r\n          for (const key in resData) {\r\n            if (resData.hasOwnProperty(key)) {\r\n              places.push(\r\n                new fbRec(\r\n                  resData[key].place, \r\n                  resData[key].rec1, \r\n                  resData[key].rec2,\r\n                  resData[key].rec3\r\n                )\r\n              );\r\n            }\r\n          }\r\n          return places;\r\n        }),\r\n        tap(places => {\r\n          this._fbRecs.next(places);\r\n        })\r\n      );\r\n  }\r\n\r\n  // add new place\r\n  addBlock(name: string, postal: string, landArea: Float32Array, grossFloorArea: Float32Array, tenure: string, numRooms: Int16Array, numStorey: Int16Array, askingPrice: Float32Array, priceRoom: Float32Array, GFA: string, roomRate: Float32Array, netOperatingProfit: Float32Array, approvedUsage: string, LocationMRT: string, LocationSch: string) {\r\n    const newBlock = new fbPostal(\r\n      name,\r\n      postal,\r\n      landArea,\r\n      grossFloorArea,\r\n      tenure,\r\n      numRooms,\r\n      numStorey,\r\n      askingPrice,\r\n      priceRoom,\r\n      GFA,\r\n      roomRate,\r\n      netOperatingProfit,\r\n      approvedUsage,\r\n      LocationMRT,\r\n      LocationSch\r\n    );\r\n    return this.http\r\n      .post('https://propnexpostals-default-rtdb.asia-southeast1.firebasedatabase.app/.json',\r\n      { ...newBlock })\r\n      .pipe(\r\n        switchMap(resData => {\r\n          return this.fbPostals;\r\n        }),\r\n        take(1),\r\n        tap(fbUsers => {\r\n          this._fbPostals.next(fbUsers.concat(newBlock));\r\n        })\r\n      );\r\n  }\r\n\r\n  // edit existing place\r\n  editBlock(targetPostal: string, newName: string) {\r\n    let updatedUsers: fbPostal[];\r\n    return this.fbPostals.pipe(\r\n      take(1),\r\n      switchMap(users => {\r\n        if (!users || users.length <= 0) {\r\n          return this.fetchFBPostals();\r\n        } else {\r\n          return of(users);\r\n        }\r\n      }),\r\n      switchMap(users => {\r\n        const updatedUserIndex = users.findIndex(u => u.postal === targetPostal);\r\n        updatedUsers = [...users];\r\n        const oldPlace = updatedUsers[updatedUserIndex];\r\n        updatedUsers[updatedUserIndex] = new fbPostal(\r\n          newName,\r\n          oldPlace.postal,\r\n          oldPlace.landArea,\r\n          oldPlace.grossFloorArea,\r\n          oldPlace.tenure,\r\n          oldPlace.numRooms,\r\n          oldPlace.numStorey,\r\n          oldPlace.askingPrice,\r\n          oldPlace.priceRoom,\r\n          oldPlace.GFA,\r\n          oldPlace.roomRate,\r\n          oldPlace.netOperatingProfit,\r\n          oldPlace.approvedUsage,\r\n          oldPlace.locationMRT,\r\n          oldPlace.locationSch,\r\n          oldPlace.imageUrl\r\n        );\r\n        this.currPlace = updatedUsers[updatedUserIndex];\r\n        return this.http.put(\r\n          `https://propnexpostals-default-rtdb.asia-southeast1.firebasedatabase.app/${updatedUserIndex}.json`,\r\n          { ...updatedUsers[updatedUserIndex] }\r\n        );\r\n      }),\r\n      tap(() => {\r\n        this._fbPostals.next(updatedUsers);\r\n      })\r\n    );\r\n  }\r\n\r\n  // add new unit to existing place\r\n  addUnit(targetPostal: string, unitNumber: string, bedrooms: string, size: string, UnitFacing: string) {\r\n    let updatedPlaces: fbPostal[];\r\n    return this.fbPostals.pipe(\r\n      take(1),\r\n      switchMap(places => {\r\n        if (!places || places.length <= 0) {\r\n          return this.fetchFBPostals();\r\n        } else {\r\n          return of(places);\r\n        }\r\n      }),\r\n      switchMap(places => {\r\n        const updatedPlaceIndex = places.findIndex(p => p.postal === targetPostal);\r\n        updatedPlaces = [...places];\r\n        const oldPlace = updatedPlaces[updatedPlaceIndex];\r\n        const newUnit = new fbUnit(\r\n          bedrooms,\r\n          `assets/placeholders/floorplan.png`,\r\n          size,\r\n          unitNumber,\r\n          UnitFacing\r\n        );\r\n        let newUnitsArr = oldPlace.units || [];\r\n        newUnitsArr = newUnitsArr.concat(newUnit);\r\n        \r\n        updatedPlaces[updatedPlaceIndex] = new fbPostal(\r\n          oldPlace.name,\r\n          oldPlace.postal,\r\n          oldPlace.landArea,\r\n          oldPlace.grossFloorArea,\r\n          oldPlace.tenure,\r\n          oldPlace.numRooms,\r\n          oldPlace.numStorey,\r\n          oldPlace.askingPrice,\r\n          oldPlace.priceRoom,\r\n          oldPlace.GFA,\r\n          oldPlace.roomRate,\r\n          oldPlace.netOperatingProfit,\r\n          oldPlace.approvedUsage,\r\n          oldPlace.locationMRT,\r\n          oldPlace.locationSch,\r\n          oldPlace.imageUrl,\r\n          newUnitsArr\r\n        );\r\n        this.currPlace = updatedPlaces[updatedPlaceIndex];\r\n        this.currUnit = newUnit;\r\n        return this.http.put(\r\n          `https://propnexpostals-default-rtdb.asia-southeast1.firebasedatabase.app/${updatedPlaceIndex}.json`,\r\n          { ...updatedPlaces[updatedPlaceIndex] }\r\n        );\r\n      }),\r\n      tap(() => {\r\n        this._fbPostals.next(updatedPlaces);\r\n      })\r\n    );\r\n  }\r\n\r\n  // edit existing unit in existing place\r\n  editUnit(targetPostal: string, targetUnitNum: string, newUnit: fbUnit) {\r\n    let updatedUsers: fbPostal[];\r\n    return this.fbPostals.pipe(\r\n      take(1),\r\n      switchMap(users => {\r\n        if (!users || users.length <= 0) {\r\n          return this.fetchFBPostals();\r\n        } else {\r\n          return of(users);\r\n        }\r\n      }),\r\n      switchMap(users => {\r\n        const updatedUserIndex = users.findIndex(u => u.postal === targetPostal);\r\n        updatedUsers = [...users];\r\n        const oldPlace = updatedUsers[updatedUserIndex];\r\n        const oldUnitIndex = oldPlace.units.findIndex(u => u.unitNumber === targetUnitNum);\r\n        oldPlace.units[oldUnitIndex] = newUnit;\r\n        let newFavArr = oldPlace.units;\r\n        updatedUsers[updatedUserIndex] = new fbPostal(\r\n          oldPlace.name,\r\n          oldPlace.postal,\r\n          oldPlace.landArea,\r\n          oldPlace.grossFloorArea,\r\n          oldPlace.tenure,\r\n          oldPlace.numRooms,\r\n          oldPlace.numStorey,\r\n          oldPlace.askingPrice,\r\n          oldPlace.priceRoom,\r\n          oldPlace.GFA,\r\n          oldPlace.roomRate,\r\n          oldPlace.netOperatingProfit,\r\n          oldPlace.approvedUsage,\r\n          oldPlace.locationMRT,\r\n          oldPlace.locationSch,\r\n          oldPlace.imageUrl,\r\n          newFavArr\r\n        );\r\n        this.currPlace = updatedUsers[updatedUserIndex];\r\n        this.currUnit = newUnit;\r\n        return this.http.put(\r\n          `https://propnexpostals-default-rtdb.asia-southeast1.firebasedatabase.app/${updatedUserIndex}.json`,\r\n          { ...updatedUsers[updatedUserIndex] }\r\n        );\r\n      }),\r\n      tap(() => {\r\n        this._fbPostals.next(updatedUsers);\r\n      })\r\n    );\r\n  }\r\n\r\n  // edit all existing units with same unit number in existing place\r\n  editAllUnit(targetPostal: string, targetUnitNum: string, newBedrooms: string, newSize: string) {\r\n    let updatedUsers: fbPostal[];\r\n    return this.fbPostals.pipe(\r\n      take(1),\r\n      switchMap(users => {\r\n        if (!users || users.length <= 0) {\r\n          return this.fetchFBPostals();\r\n        } else {\r\n          return of(users);\r\n        }\r\n      }),\r\n      switchMap(users => {\r\n        const updatedUserIndex = users.findIndex(u => u.postal === targetPostal);\r\n        updatedUsers = [...users];\r\n        const oldPlace = updatedUsers[updatedUserIndex];\r\n\r\n        let targetString = '-' + targetUnitNum.split('-')[1];\r\n        let unitArr = oldPlace.units.filter(u => u.unitNumber.includes(targetString));\r\n\r\n        unitArr.forEach(u => {\r\n          u.bedrooms = newBedrooms;\r\n          u.size = newSize;\r\n        });\r\n\r\n        for (let i = 0; i < unitArr.length; i++) {\r\n          let currUnitNum = unitArr[i].unitNumber;\r\n          let currIndex = oldPlace.units.findIndex(u => u.unitNumber === currUnitNum);\r\n          oldPlace.units[currIndex] = unitArr[i];\r\n        }\r\n        \r\n        const oldUnitIndex = oldPlace.units.findIndex(u => u.unitNumber === targetUnitNum);\r\n\r\n        updatedUsers[updatedUserIndex] = new fbPostal(\r\n          oldPlace.name,\r\n          oldPlace.postal,\r\n          oldPlace.landArea,\r\n          oldPlace.grossFloorArea,\r\n          oldPlace.tenure,\r\n          oldPlace.numRooms,\r\n          oldPlace.numStorey,\r\n          oldPlace.askingPrice,\r\n          oldPlace.priceRoom,\r\n          oldPlace.GFA,\r\n          oldPlace.roomRate,\r\n          oldPlace.netOperatingProfit,\r\n          oldPlace.approvedUsage,\r\n          oldPlace.locationMRT,\r\n          oldPlace.locationSch,\r\n          oldPlace.imageUrl,\r\n          oldPlace.units\r\n        );\r\n        this.currPlace = updatedUsers[updatedUserIndex];\r\n        this.currUnit = oldPlace.units[oldUnitIndex];\r\n        return this.http.put(\r\n          `https://propnexpostals-default-rtdb.asia-southeast1.firebasedatabase.app/${updatedUserIndex}.json`,\r\n          { ...updatedUsers[updatedUserIndex] }\r\n        );\r\n      }),\r\n      tap(() => {\r\n        this._fbPostals.next(updatedUsers);\r\n      })\r\n    );\r\n  }\r\n}\r\n"],"sourceRoot":"webpack:///"}